---
import Layout from "../../layouts/Layout.astro";
import TablerIcon from "../../components/TablerIcon.astro";
import type { Project } from "../../lib/projects";

interface Tool {
  src: string;
  alt: string;
}

interface Props {
  project: Project;
  tools: readonly Tool[];
  heroImage: string;
  heroAlt?: string;
  heroHasSurface?: boolean;
  overviewHeading: string;
  overviewText: string;
  duration: string;
  projectType: string;
}

const {
  project,
  tools,
  heroImage,
  heroAlt = `Podgląd projektu ${project.title}`,
  heroHasSurface = false,
  overviewHeading,
  overviewText,
  duration,
  projectType,
} = Astro.props;
---

<Layout title={project.title} description={project.description}>
  <section class="hidden px-[32px] pt-[32px] lg:block lg:px-16 lg:pt-[40px]" aria-label="Separator sekcji projektu">
    <div class="mx-auto flex min-h-[20px] w-full items-center">
      <div class="h-px w-full border-b border-[var(--color-subtle)]"></div>
    </div>
  </section>
  <section class="px-[32px] pt-[32px] lg:hidden" aria-label="Separator sekcji projektu mobilnie">
    <div class="flex min-h-[20px] items-center">
      <div class="h-px w-full border-b border-[var(--color-subtle)]"></div>
    </div>
  </section>

  <article class="mx-auto w-full max-w-[1040px] px-6 pb-[120px] pt-[80px] lg:px-0 lg:pb-[200px] lg:pt-[80px]" aria-labelledby="work-detail-title">
    <div class="sticky top-[32px] z-30 hidden h-0 w-full lg:block">
      <div class="flex justify-end pr-[24px]">
        <a
          href="/work"
          data-case-study-close
          class="flex size-[44px] items-center justify-center rounded-full border border-[#0e0e0e] bg-[var(--color-background)] text-[var(--color-text)] transition-colors hover:bg-[var(--color-foreground)]"
          aria-label="Powrót do listy projektów"
        >
          <TablerIcon name="x" class="size-[24px]" />
        </a>
      </div>
    </div>

    <div class="flex flex-col gap-[80px] lg:gap-[120px]">
      <header class="mx-auto flex w-full max-w-[864px] flex-col gap-[40px]">
        <div class="flex flex-col gap-[24px]">
          <h1
            id="work-detail-title"
            class="text-[24px] leading-[32px] text-[var(--color-text)] lg:text-[32px] lg:leading-[44px]"
            transition:name={`work-${project.slug}-title`}
          >
            {project.title}
          </h1>

          <ul class="flex flex-wrap items-center gap-[16px]" aria-label="Tagi projektu">
            {
              project.tags.map((tag, tagIndex) => (
                <li
                  class="rounded-[5555px] border border-[var(--color-border)] px-[12px] py-[8px] text-[14px] leading-[20px] tracking-[0.25px] text-[var(--color-text)]"
                  transition:name={`work-${project.slug}-tag-${tagIndex}`}
                >
                  {tag}
                </li>
              ))
            }
          </ul>
        </div>

        <div
          class:list={[
            "relative h-[420px] w-full overflow-hidden lg:h-[568px]",
            heroHasSurface ? "bg-[var(--color-surface)]" : "",
          ]}
          transition:name={`work-${project.slug}-card`}
        >
          <img
            src={heroImage}
            alt={heroAlt}
            class="size-full object-cover"
            transition:name={`work-${project.slug}-image`}
          />
        </div>
      </header>

      <section class="mx-auto grid w-full max-w-[864px] gap-[32px] lg:grid-cols-[598px_215px] lg:items-start" aria-label="Project overview">
        <div class="flex flex-col gap-[24px]">
          <div class="flex flex-col gap-[14px]">
            <p class="text-[12px] uppercase leading-[16px] tracking-[0.4px] text-[#474747]">Project overview</p>
            <h2 class="text-[24px] leading-[32px] lg:text-[36px] lg:leading-[44px] text-[var(--color-text)]">{overviewHeading}</h2>
          </div>
          <div class="h-px w-full bg-[var(--color-border)]"></div>
          <p class="text-[14px] lg:text-[16px] leading-[24px] tracking-[0.5px] text-[var(--color-text)]">{overviewText}</p>
        </div>

        <aside class="flex flex-col gap-[20px]" aria-label="Informacje o projekcie">
          <div class="rounded-[12px] border border-[var(--color-border)] px-[20px] py-[14px]">
            <p class="text-[14px] font-medium leading-[20px] tracking-[0.25px] text-[var(--color-text)]">Czas trwania</p>
            <p class="mt-[12px] text-[14px] leading-[20px] tracking-[0.25px] text-[#6a6a6a]">{duration}</p>
          </div>

          <div class="rounded-[12px] border border-[var(--color-border)] px-[20px] py-[14px]">
            <p class="text-[14px] font-medium leading-[20px] tracking-[0.25px] text-[var(--color-text)]">Typ projektu</p>
            <p class="mt-[12px] text-[14px] leading-[20px] tracking-[0.25px] text-[#6a6a6a]">{projectType}</p>
          </div>

          <div class="rounded-[12px] border border-[var(--color-border)] px-[20px] py-[14px]">
            <p class="text-[14px] font-medium leading-[20px] tracking-[0.25px] text-[var(--color-text)]">Narzędzia</p>
            <ul class="mt-[12px] flex items-start gap-[16px]" aria-label="Narzędzia projektu">
              {
                tools.map((tool) => (
                  <li>
                    <img src={tool.src} alt={tool.alt} class="size-[24px] object-cover" loading="lazy" />
                  </li>
                ))
              }
            </ul>
          </div>
        </aside>
      </section>

      <slot />
    </div>
  </article>
</Layout>

<script is:inline>
  (() => {
    const closeSelector = "[data-case-study-close]";

    const onClick = (event) => {
      const target = event.target;
      if (!(target instanceof Element)) return;

      const closeLink = target.closest(closeSelector);
      if (!(closeLink instanceof HTMLAnchorElement)) return;

      const hasSameOriginReferrer =
        typeof document.referrer === "string" &&
        document.referrer.startsWith(window.location.origin);

      if (window.history.length > 1 && hasSameOriginReferrer) {
        event.preventDefault();
        window.history.back();
      }
    };

    document.addEventListener("click", onClick);
  })();
</script>
