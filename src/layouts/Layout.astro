---
interface Props {
  title: string;
  description?: string;
  showFooter?: boolean;
}

const {
  title,
  description = "Portfolio UX/UI z płynnymi przejściami między podstronami",
  showFooter = true,
} = Astro.props;

import { ClientRouter } from "astro:transitions";
import "./layout.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";
---

<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script is:inline>
      (() => {
        const root = document.documentElement;
        const storedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const isDark = storedTheme ? storedTheme === "dark" : prefersDark;

        root.classList.toggle("dark", isDark);
        root.style.colorScheme = isDark ? "dark" : "light";
        root.style.backgroundColor = isDark ? "#111111" : "#fefefe";
      })();
    </script>
    <link rel="preconnect" href="https://api.fontshare.com" />
    <link rel="preconnect" href="https://fonts.bunny.net" crossorigin />
    <link rel="stylesheet" href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500&display=swap" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="shortcut icon" href="/favicon-light.ico"  media="(prefers-color-scheme:light)" />
    <link rel="shortcut icon" href="/favicon-dark.ico"  media="(prefers-color-scheme:dark)" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Portfolio" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="light dark" />
    <title>{title} | Portfolio</title>
    <ClientRouter />
    <script is:inline>
      function getIsDarkTheme() {
        const theme = localStorage.getItem("theme");
        if (theme === "light") return false;
        if (theme === "dark") return true;
        return window.matchMedia("(prefers-color-scheme: dark)").matches;
      }

      function applyThemeToRoot(root) {
        const isDark = getIsDarkTheme();
        root.classList.toggle("dark", isDark);
        root.style.colorScheme = isDark ? "dark" : "light";
        root.style.backgroundColor = isDark ? "#111111" : "#fefefe";
      }

      function applyTheme() {
        applyThemeToRoot(document.documentElement);
      }

      // Apply on initial load
      applyTheme();

      // Apply to current and incoming document before swap to avoid theme flash
      document.addEventListener("astro:before-swap", (event) => {
        applyTheme();
        const incomingRoot = event?.newDocument?.documentElement;
        if (incomingRoot) {
          applyThemeToRoot(incomingRoot);
        }
      });
      document.addEventListener("astro:after-swap", applyTheme);
    </script>
    <Analytics />
    <SpeedInsights />
  </head>
    <body class="min-h-screen flex flex-col bg-[var(--color-background)]">
      <a href="#main-content" class="skip-to-content">
        Przejdź do treści
      </a>
      <Header />
      <main id="main-content" class="flex-1">
        <slot />
      </main>
      {showFooter && <Footer />}
    </body>
  </html>
