---
import Layout from "../layouts/Layout.astro";
import TablerIcon from "../components/TablerIcon.astro";

const email = "mszczecinska01@gmail.com";
const mailtoHref = `mailto:${email}?subject=Zapytanie%20o%20wsp%C3%B3%C5%82prac%C4%99`;
---

<Layout title="Contact" description="Skontaktuj się w sprawie współpracy UX/UI">
  <div class="px-[32px] pt-[32px] sm:px-10 sm:pt-[36px] lg:px-16 lg:pt-[40px]" aria-hidden="true">
    <div class="mx-auto flex min-h-[20px] w-full items-center">
      <div class="h-px w-full border-b border-[var(--color-subtle)]"></div>
    </div>
  </div>

  <section
    class="contact-split-section mx-auto w-full max-w-[1040px] px-6 pb-[120px] pt-[56px] sm:px-8 sm:pb-[144px] sm:pt-[72px] lg:px-0 lg:pb-[200px] lg:pt-[120px]"
    aria-labelledby="contact-page-title"
  >
    <div class="grid gap-[32px] lg:grid-cols-[507px_1fr] lg:items-center lg:gap-[64px]">
      <div class="contact-split-left flex flex-col gap-[24px]">
        <h1 id="contact-page-title" class="text-[24px] font-medium leading-[44px] tracking-[0] text-[var(--color-text)] lg:text-[36px]">
          Masz pomysł na projekt? Porozmawiajmy!
        </h1>

        <div class="h-[2px] w-full bg-[var(--color-divider)]"></div>

        <p class="text-[16px] leading-[24px] tracking-[0.5px] text-[var(--color-text)]">
          Chcesz rozpocząć nowy projekt, odświeżyć swoją stronę internetową lub po prostu porozmawiać o swoich pomysłach? Napisz wiadomość!
        </p>
      </div>

      <aside class="contact-split-right rounded-[16px] border border-[var(--color-border)] bg-[var(--color-foreground)] p-[20px] lg:px-[20px] lg:py-[24px]" aria-label="Kontakt e-mail">
        <div class="flex flex-col gap-[24px] lg:gap-[32px]">
          <div class="flex flex-col gap-[14px] lg:gap-[20px]">
            <p class="text-[10px] uppercase leading-[16px] tracking-[0.5px] text-[var(--color-text-muted)] lg:text-[12px]">E-mail</p>

            <div class="flex items-start gap-[12px]">
              <a
                href={mailtoHref}
                class="text-[16px] leading-[24px] tracking-[0.5px] text-[var(--color-text)] hover:underline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-text)] lg:text-[20px]"
              >
                {email}
              </a>

              <div class="group relative inline-flex" data-copy-tooltip-group>
                <button
                  type="button"
                  data-copy-email-button
                  data-email={email}
                  class="btn-icon size-[24px] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-text)]"
                  aria-label="Skopiuj adres e-mail"
                >
                  <span data-copy-icon>
                    <TablerIcon name="copy" class="size-[24px]" />
                  </span>
                  <span data-copy-check-icon hidden>
                    <TablerIcon name="copy-check" class="size-[24px]" />
                  </span>
                </button>

                <span
                  data-copy-tooltip
                  class="pointer-events-none absolute bottom-full left-1/2 z-20 mb-[8px] inline-flex min-w-[220px] -translate-x-1/2 translate-y-[2px] scale-[0.98] items-center justify-center rounded-[999px] border border-[var(--color-primary-border)] bg-[var(--color-primary-bg)] px-[18px] py-[7px] text-center text-[12px] leading-[16px] text-[var(--color-primary-fg)] opacity-0 transition-all duration-200 ease-in-out group-hover:translate-y-0 group-hover:scale-100 group-hover:opacity-100"
                  aria-hidden="true"
                >
                  Kliknij, aby skopiować e-mail
                </span>
              </div>
            </div>

          </div>

          <a
            href={mailtoHref}
            class="btn-primary w-fit px-[20px] py-[12px] text-[14px] font-medium leading-[20px] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-text)] lg:px-[24px] lg:py-[14px] lg:text-[16px]"
          >
            Napisz wiadomość
          </a>
        </div>

        <p data-copy-status class="sr-only" aria-live="polite"></p>
      </aside>
    </div>
  </section>
</Layout>

<style>
  .contact-split-left,
  .contact-split-right {
    opacity: 0;
    transition:
      opacity 520ms cubic-bezier(0.22, 1, 0.36, 1),
      transform 520ms cubic-bezier(0.22, 1, 0.36, 1);
    will-change: opacity, transform;
  }

  .contact-split-left {
    transform: translateX(24px);
  }

  .contact-split-right {
    transform: translateX(-24px);
  }

  .contact-split-section.is-visible .contact-split-left,
  .contact-split-section.is-visible .contact-split-right {
    opacity: 1;
    transform: translateX(0);
  }

  @media (max-width: 1023px) {
    .contact-split-left,
    .contact-split-right {
      transform: translateY(12px);
    }
  }

  [data-copy-tooltip-group][data-tooltip-locked="true"] [data-copy-tooltip] {
    opacity: 0 !important;
  }

  @media (prefers-reduced-motion: reduce) {
    .contact-split-left,
    .contact-split-right,
    .contact-split-section.is-visible .contact-split-left,
    .contact-split-section.is-visible .contact-split-right {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>

<script is:inline>
  (() => {
    const STATE_KEY = "__contactSplitAnimationState";
    const state =
      window[STATE_KEY] ??
      (window[STATE_KEY] = {
        pageLoadBound: false,
      });

    const initContactSplitAnimation = () => {
      const section = document.querySelector(".contact-split-section");
      if (!(section instanceof HTMLElement)) return;
      const isMobile = window.matchMedia("(max-width: 1023px)").matches;

      if (isMobile || window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
        section.classList.add("is-visible");
        return;
      }

      section.classList.remove("is-visible");
      requestAnimationFrame(() => {
        section.classList.add("is-visible");
      });
    };

    initContactSplitAnimation();
    if (!state.pageLoadBound) {
      document.addEventListener("astro:page-load", initContactSplitAnimation);
      state.pageLoadBound = true;
    }
  })();
</script>

<script is:inline>
  (() => {
    const initContactCopy = () => {
      const copyButton = document.querySelector("[data-copy-email-button]");
      const statusNode = document.querySelector("[data-copy-status]");
      const copyIcon = document.querySelector("[data-copy-icon]");
      const copyCheckIcon = document.querySelector("[data-copy-check-icon]");
      const tooltipGroup = document.querySelector("[data-copy-tooltip-group]");

      if (
        !(copyButton instanceof HTMLButtonElement) ||
        !(statusNode instanceof HTMLElement) ||
        !(copyIcon instanceof HTMLElement) ||
        !(copyCheckIcon instanceof HTMLElement) ||
        !(tooltipGroup instanceof HTMLElement)
      ) {
        return;
      }

      if (copyButton.dataset.bound === "true") {
        return;
      }
      copyButton.dataset.bound = "true";

      let timeoutId = 0;
      const setCopyIconState = (isSuccess) => {
        copyIcon.hidden = isSuccess;
        copyCheckIcon.hidden = !isSuccess;
      };

      const setStatus = (message, type) => {
        const isSuccess = type === "success";
        setCopyIconState(isSuccess);

        statusNode.textContent = message;

        if (timeoutId) {
          window.clearTimeout(timeoutId);
        }

        window.setTimeout(() => {
          if (statusNode.textContent === message) {
            statusNode.textContent = "";
          }
        }, 1600);

        timeoutId = window.setTimeout(() => {
          setCopyIconState(false);
          tooltipGroup.removeAttribute("data-tooltip-locked");
        }, 1600);
      };

      const hideTooltip = () => {
        tooltipGroup.setAttribute("data-tooltip-locked", "true");
      };

      copyButton.addEventListener("click", async () => {
        hideTooltip();
        const value = copyButton.getAttribute("data-email");
        if (!value) {
          setStatus("Nie udało się skopiować adresu e-mail.", "error");
          return;
        }

        try {
          await navigator.clipboard.writeText(value);
          setStatus("Adres e-mail został skopiowany.", "success");
        } catch {
          setStatus("Nie udało się skopiować adresu e-mail.", "error");
        }
      });
    };

    initContactCopy();
    document.addEventListener("astro:page-load", initContactCopy);
  })();
</script>
